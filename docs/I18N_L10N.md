# Internationalization & Localization (i18n/l10n)

## Overview

MIDIcurator includes foundational internationalization support to ensure inclusivity and compliance with Canada's **Official Languages Act**. The implementation uses `react-i18next` for React integration and provides bilingual support for English and French Canadian locales.

## Status

**Current:** Foundation complete, partially integrated (Feb 2026)
**Next:** Full UI integration and accessibility audit

## Architecture

### Technology Stack
- **i18next**: Core i18n framework
- **react-i18next**: React bindings and hooks
- **i18next-browser-languagedetector**: Automatic language detection

### Locale Structure

```
src/i18n/
‚îú‚îÄ‚îÄ index.ts                 # i18next configuration
‚îú‚îÄ‚îÄ types.ts                 # TypeScript type definitions
‚îú‚îÄ‚îÄ hooks/                   # Custom i18n hooks (future)
‚îú‚îÄ‚îÄ utils/                   # i18n utilities (future)
‚îî‚îÄ‚îÄ locales/
    ‚îú‚îÄ‚îÄ en-CA/               # English Canadian
    ‚îÇ   ‚îú‚îÄ‚îÄ common.json      # UI labels, buttons, actions
    ‚îÇ   ‚îú‚îÄ‚îÄ accessibility.json  # ARIA labels, screen reader text
    ‚îÇ   ‚îú‚îÄ‚îÄ messages.json    # User-facing messages
    ‚îÇ   ‚îú‚îÄ‚îÄ notes.json       # Music note names
    ‚îÇ   ‚îú‚îÄ‚îÄ chords.json      # Chord terminology
    ‚îÇ   ‚îî‚îÄ‚îÄ progressions.json  # Progression descriptions
    ‚îî‚îÄ‚îÄ fr-CA/               # French Canadian
        ‚îî‚îÄ‚îÄ (mirror structure)
```

### Namespace Organization

| Namespace | Purpose | Examples |
|-----------|---------|----------|
| `common` | General UI elements | "Play", "Pause", "Download MIDI" |
| `accessibility` | ARIA labels, screen reader text | "Play pattern (Space)", "Download clip as MIDI file" |
| `messages` | User-facing notifications | Error messages, success confirmations (future) |
| `notes` | Music theory: note names | "C", "D‚ôØ", "B‚ô≠" (future) |
| `chords` | Music theory: chord symbols | "Maj7", "m7‚ô≠5", "sus4" (future) |
| `progressions` | Harmonic descriptions | "I-IV-V", "ii-V-I" (future) |

## Features Implemented

### Language Detection & Persistence
- Auto-detects browser/system language on first visit
- Falls back to `en-CA` if no match
- Persists user preference to `localStorage` as `i18nextLng`
- Updates `<html lang>` attribute on language change

### LanguageToggle Component
- EN/FR toggle button (`src/components/LanguageToggle.tsx`)
- ARIA-compliant with translated labels
- Shows target language name (e.g., "FR" when English active)

### Type Safety
- Full TypeScript integration via module augmentation
- Autocomplete for translation keys in IDEs
- Compile-time validation of translation namespaces

### RTL Readiness
- Infrastructure for future right-to-left language support (Arabic, Hebrew)
- Auto-updates `<html dir>` attribute

## Current Translations

### Fully Translated Strings (38 common + 26 accessibility)

**Common UI:**
- Playback controls: Play, Pause, Stop
- File operations: Download MIDI, Delete
- Generators: Generate 1/5 Variant(s)
- Filters & tags: Tags, Filter by tag, Clear filter
- Clip metadata: BPM, Chord, Notes, Density, Syncopation
- Welcome screen: Drop MIDI files, Welcome message

**Accessibility:**
- ARIA labels for all playback controls
- Screen reader descriptions for clip cards
- Contextual help text (e.g., "Click to edit tempo")
- Language toggle labels

### Placeholder Namespaces (to be populated)

- **notes.json**: Placeholder for pitch class names, enharmonic spellings
- **chords.json**: Placeholder for chord quality names, interval descriptions
- **progressions.json**: Placeholder for Roman numeral analysis, function labels

## Integration Status

### ‚úÖ Completed
- i18next configuration with language detection
- TypeScript type definitions
- JSON translation files (en-CA, fr-CA)
- LanguageToggle component

### üöß Partially Integrated
- LanguageToggle component exists but not rendered in UI yet
- Translation keys defined but most components still use hardcoded strings

### ‚è≥ Not Yet Started
- Notes namespace population (requires music theory integration)
- Chords namespace population (chord-dictionary.ts integration)
- Progressions namespace (harmonic analysis terminology)
- Dynamic content translation (user-generated tags, filenames)
- Date/time formatting (Intl API integration)
- Number formatting (locale-aware BPM, density display)

## Usage Examples

### Basic Hook Usage
```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation(); // Defaults to 'common' namespace

  return (
    <button>{t('play')}</button>  // "Play" or "Lecture"
  );
}
```

### Multiple Namespaces
```tsx
const { t } = useTranslation(['common', 'accessibility']);

<button
  aria-label={t('accessibility:play_pattern_label')}
>
  {t('common:play')}
</button>
```

### Interpolation
```tsx
t('clip_count', { count: 5 })  // "5 clips" or "5 extraits"
t('accessibility:current_time_label', { time: '1:23' })
```

### Pluralization
```tsx
// Uses _one and _other suffixes
t('clip_count', { count: 1 })  // "1 clip" / "1 extrait"
t('clip_count', { count: 5 })  // "5 clips" / "5 extraits"
```

## Official Languages Act Compliance

### Requirements
As a tool potentially used in Canadian federal workplaces, MIDIcurator aims to comply with Part IV of the **Official Languages Act** (R.S.C., 1985, c. 31):

- **Equal Status**: English and French have equal status
- **Active Offer**: Both languages should be equally visible/accessible
- **Quality**: Translations must be professional, not machine-generated
- **Simultaneity**: Updates should be bilingual from the start

### Current Compliance Status
- ‚úÖ Infrastructure supports equal status (en-CA/fr-CA treated identically)
- ‚úÖ Active offer via LanguageToggle (once integrated)
- ‚ö†Ô∏è Translation quality: Foundation translations are high-quality, but music theory terms need domain expert review
- ‚è≥ Simultaneity: Needs integration into development workflow

### Recommended Next Steps
1. **UI Integration**: Render LanguageToggle in app header/settings
2. **Component Migration**: Systematically replace hardcoded strings with `t()` calls
3. **Translation Review**: Engage French-speaking musicians for music theory terminology
4. **Documentation**: Translate README, user guides, inline help

## Accessibility (#a11y) Integration

i18n and accessibility are intertwined:

### Screen Reader Support
- Separate `accessibility` namespace for ARIA labels
- More verbose descriptions than visible UI text
- Example: Button shows "Play" but ARIA says "Play pattern (Space)"

### Keyboard Navigation
- Shortcut hints included in ARIA labels (e.g., "Space", "Ctrl+S")
- Future: Dynamic shortcut descriptions from keybindings

### Semantic HTML
- `lang` attribute updates ensure correct pronunciation
- Future: Language-specific typography (fonts, line-height)

### WCAG Compliance
- All interactive elements have translated ARIA labels
- Future: Translated alt text for any images, charts

## Future Enhancements

### Phase 2: Full UI Translation
- Migrate all components to use `useTranslation`
- Translate error messages, tooltips, placeholders
- Add translation coverage tests

### Phase 3: Music Theory Localization
- Populate notes.json with pitch class names
  - Handle enharmonic spellings (Do/C, R√©/D in solf√®ge)
  - Sharp (‚ôØ/di√®se) vs flat (‚ô≠/b√©mol) terminology
- Populate chords.json with quality names
  - "Major 7th" ‚Üí "Septi√®me majeure"
  - "Diminished" ‚Üí "Diminu√©"
- Populate progressions.json with Roman numeral systems
  - Consider European vs North American conventions

### Phase 4: Extended Locales
- Add Quebec French variant (fr-QC) if needed
- Consider other languages (Spanish, Mandarin for global users)
- RTL language support (Arabic, Hebrew)

### Phase 5: Content Localization
- User-generated content (tags, notes) stays in original language
- System-generated content (chord symbols, analysis) follows locale
- Optional: Machine translation for user content

### Phase 6: Advanced Formatting
- Intl.DateTimeFormat for timestamps
- Intl.NumberFormat for BPM, density (comma vs period)
- Intl.PluralRules for complex pluralization

## Developer Guidelines

### Adding New Translations

1. **Add keys to both locales** (en-CA and fr-CA)
   ```json
   // en-CA/common.json
   "new_feature": "New Feature"

   // fr-CA/common.json
   "new_feature": "Nouvelle fonctionnalit√©"
   ```

2. **Use in component**
   ```tsx
   const { t } = useTranslation();
   return <h2>{t('new_feature')}</h2>;
   ```

3. **TypeScript autocomplete** will suggest the new key

### Translation Key Naming
- Use `snake_case` for keys
- Namespace by domain, not by component
- Prefer semantic names over literal text
  - ‚úÖ `chord_not_recognized`
  - ‚ùå `the_chord_could_not_be_recognized`

### Choosing Namespaces
- `common`: UI chrome, actions, labels
- `accessibility`: ARIA-specific descriptions
- `messages`: User notifications, errors, success
- `notes/chords/progressions`: Music theory domain

### Testing Translations
```tsx
// In tests, mock i18next
jest.mock('react-i18next', () => ({
  useTranslation: () => ({
    t: (key: string) => key,
    i18n: { language: 'en-CA' }
  })
}));
```

## Dependencies

Missing dependencies (need to be installed):

```json
{
  "dependencies": {
    "i18next": "^23.x",
    "react-i18next": "^14.x",
    "i18next-browser-languagedetector": "^7.x"
  }
}
```

## Related Documentation

- [Accessibility Roadmap](./ACCESSIBILITY.md) (future)
- [Official Languages Act](https://laws-lois.justice.gc.ca/eng/acts/o-3.01/)
- [i18next Documentation](https://www.i18next.com/)
- [react-i18next Documentation](https://react.i18next.com/)

## Change Log

- **2026-02-15**: Initial i18n infrastructure, EN/FR translations for core UI
- **2026-02-16**: Documentation created, dependency installation pending

---

**Maintainer Note:** This foundation represents commitment to inclusivity and compliance. Full integration is a gradual process‚Äîprioritize high-visibility UI elements first, then systematically migrate components.
